<!DOCTYPE html>
<html lang="es-mx">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Reversing de IOLI Crackmes con Cutter - Crackme0x02 - xbytemx blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Tony Palma" /><meta name="description" content="Nuevamente a usar Cutter para resolver crackmes! En esta ocasión continuamos con la serie de crackmes de IOLI, ahora resolviendo el 3er crackme" />







<meta name="generator" content="Hugo 0.47.1" />


<link rel="canonical" href="https://xbytemx.github.io/post/ioli-crackmes-cutter_-_crackme0x02/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">







<link href="/dist/even.min.css?v=3.2.0" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="Reversing de IOLI Crackmes con Cutter - Crackme0x02" />
<meta property="og:description" content="Nuevamente a usar Cutter para resolver crackmes! En esta ocasión continuamos con la serie de crackmes de IOLI, ahora resolviendo el 3er crackme" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xbytemx.github.io/post/ioli-crackmes-cutter_-_crackme0x02/" /><meta property="article:published_time" content="2018-10-27T22:54:21-06:00"/>
<meta property="article:modified_time" content="2018-10-27T22:54:21-06:00"/><meta property="og:site_name" content="xbytemx blog" />
<meta itemprop="name" content="Reversing de IOLI Crackmes con Cutter - Crackme0x02">
<meta itemprop="description" content="Nuevamente a usar Cutter para resolver crackmes! En esta ocasión continuamos con la serie de crackmes de IOLI, ahora resolviendo el 3er crackme">


<meta itemprop="datePublished" content="2018-10-27T22:54:21-06:00" />
<meta itemprop="dateModified" content="2018-10-27T22:54:21-06:00" />
<meta itemprop="wordCount" content="1121">



<meta itemprop="keywords" content="crackme,ioli,cutter,radare,reversing," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Reversing de IOLI Crackmes con Cutter - Crackme0x02"/>
<meta name="twitter:description" content="Nuevamente a usar Cutter para resolver crackmes! En esta ocasión continuamos con la serie de crackmes de IOLI, ahora resolviendo el 3er crackme"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">xbytemx blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">xbytemx blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Reversing de IOLI Crackmes con Cutter - Crackme0x02</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-10-27 </span>
        <div class="post-category">
            
              <a href="/categories/reversing/"> reversing </a>
            
              <a href="/categories/elf32/"> ELF32 </a>
            
          </div>
        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title"></h2>
  
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#footprint">Footprint</a></li>
<li><a href="#entrypoints">Entrypoints</a></li>
<li><a href="#strings">Strings</a></li>
<li><a href="#imports">Imports</a></li>
<li><a href="#functions">Functions</a></li>
<li><a href="#disassembly">Disassembly</a></li>
<li><a href="#grafico">Grafico</a></li>
<li><a href="#validación">Validación</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    

    
    <div class="post-content">
      

<h2 id="footprint">Footprint</h2>

<p>Comenzamos por obtener información sobre el crackme que tenemos entre manos, para ello usamos las herramientas usadas en el crackme anterior:</p>

<p>File:</p>

<p><img src="/img/cutter03/file.png" alt="File over crackme0x02" /></p>

<p>LDD:</p>

<p><img src="/img/cutter03/lld.png" alt="LDD over crackme0x02" /></p>

<p>ReadELF:</p>

<p><img src="/img/cutter03/readelf.png" alt="readELF over crackme0x02" /></p>

<p>Parece que este caso no es tan diferente a los anteriores.</p>

<p>Carguemos el archivo directo a Cutter con los valores de análisis por defecto:</p>

<p><img src="/img/cutter03/dashboard.png" alt="Dashboard de crackme0x02" /></p>

<p>También a nivel de dashboard vemos que este reto no es muy diferente a sus predecesores. Continuemos con la siguiente sección.</p>

<h2 id="entrypoints">Entrypoints</h2>

<p>Comenzamos por analizar todos los entry points de este ejecutable:</p>

<p><img src="/img/cutter03/entrypoints.png" alt="Entry Points de crackme0x02" /></p>

<p>Como podemos ver, el entry point es el mismo que ya nos decía readelf, <strong>0x8048330</strong>.</p>

<h2 id="strings">Strings</h2>

<p>Los strings dentro de este ejecutable son (ojo con la dirección):</p>

<p><img src="/img/cutter03/strings.png" alt="Strings de crackme0x02" /></p>

<p>Aparentemente no sera tan sencillo esta vez, no aparece ni por error algún valor que haga referencia al password.</p>

<h2 id="imports">Imports</h2>

<p>En la sección de imports, veremos que nuevamente llamamos a nuestras funciones de costumbre:</p>

<p><img src="/img/cutter03/imports.png" alt="Imports de crackme0x02" /></p>

<blockquote>
<p>Nuevamente tenemos un mensaje sobre lo inseguro que es la función scanf, ya que es altamente explotable.</p>
</blockquote>

<h2 id="functions">Functions</h2>

<p>Ahora toca revisar las funciones que tenemos en nuestro programa, las cuales son las siguientes:</p>

<p><img src="/img/cutter03/functions.png" alt="Funciones de crackme0x02" /></p>

<p>No quiero sorprender a nadie, pero esta casi idéntico a lo que teníamos en el anterior crackme&hellip; continuemos.</p>

<h2 id="disassembly">Disassembly</h2>

<p>Ahora toca el turno del Disassembly, en donde realizaremos el análisis estático para determinar que sucede dentro de este programa, vemos primero como se presenta:</p>

<p><img src="/img/cutter03/dis1.png" alt="Disassembly de crackme0x02" /></p>

<blockquote>
<p>Trate de reducir un poco el tamaño de la letra para que fuera visible toda la función main.</p>
</blockquote>

<p>Aplicando la misma metodología que hemos manejado:</p>

<pre><code>0x080483e4      push ebp
0x080483e5      mov  ebp, esp
0x080483e7      sub  esp, 0x18
0x080483ea      and  esp, 0xfffffff0
0x080483ed      mov  eax, 0
0x080483f2      add  eax, 0xf
0x080483f5      add  eax, 0xf
0x080483f8      shr  eax, 4
0x080483fb      shl  eax, 4
0x080483fe      sub  esp, eax
</code></pre>

<p>Primero tenemos el stack frame, que como hemos visto antes nos ayuda a separar lo que las variables locales usaran posteriormente.</p>

<pre><code>0x08048400      mov  dword [esp], str.IOLI_Crackme_Level_0x02 ; [0x8048548:4]=0x494c4f49 ; &quot;IOLI Crackme Level 0x02\n&quot; ; const char *format
0x08048407      call sym.imp.printf ; int printf(const char *format)
</code></pre>

<p>Continuamos con la primera llamada a printf, el cual recibe de parámetro el string &ldquo;IOLI Crackme Level 0x02\n&rdquo;, dando inicio al primer mensaje que vemos en pantalla.</p>

<pre><code>0x0804840c      mov  dword [esp], str.Password: ; [0x8048561:4]=0x73736150 ; &quot;Password: &quot; ; const char *format
0x08048413      call sym.imp.printf ; int printf(const char *format)
</code></pre>

<p>Continuamos con la segunda llamada a printf, la cual recibe de parámetro el string &ldquo;Password: &ldquo;, manteniendo el cursor sin salto de linea.</p>

<pre><code>0x08048418      lea  eax, [local_4h]
0x0804841b      mov  dword [local_4h_2], eax
0x0804841f      mov  dword [esp], 0x804856c ; [0x804856c:4]=0x50006425 ; const char *format
0x08048426      call sym.imp.scanf ; int scanf(const char *format)
</code></pre>

<p>La siguiente parte toma la variable local_4h y carga su posición en memoria sobre EAX, para después guardar dicho valor en local_4h_2. La siguiente parte carga en el stack pointer el valor de lo ubicado en 0x804856c. Finalmente scanf es llamado en donde usara el valor de la ubicación 0x804856c y la ubicación en memoria de local_4h.</p>

<p>Comenzando por las traducciones, veamos que hay en 0x804856c:
&gt; Recordemos que para ir a una posición debemos dar dos clicks izq sobre la misma.</p>

<p><img src="/img/cutter03/rodata-strings.png" alt="rodata" /></p>

<p>Hemos llegado a esta posición de .rodata, que como en el ejemplo anterior no se tradujo 100% a string, por lo que nos toca ayudar un poco.</p>

<p>Nuevamente damos click derecho, sobre la ubicación, seleccionamos &ldquo;Set to Data&rdquo;, ubicamos &ldquo;&hellip;   *&rdquo; y continuamos con la siguiente ventana donde seleccionamos tamaño 3, un solo elemento.</p>

<p><img src="/img/cutter03/code-to-data.png" alt="Convert code to data" /></p>

<p><img src="/img/cutter03/set-to-data.png" alt="Set to Data" /></p>

<p>Y ahora se ha revelado el primer parámetro de scanf:</p>

<p><img src="/img/cutter03/scanf-1.png" alt="1er parámetro de scanf" /></p>

<p>Si observamos detenidamente los parámetros que nos indica el análisis de la función, veremos algo como lo siguiente:</p>

<pre><code>; var int local_4h @ ebp-0x4
; var int local_4h_2 @ esp+0x4
</code></pre>

<p>Esto quiere decir que local_4h y local_4h_2 son reconocidos como enteros y no solo eso, por la ubicación en memoria (o el valor real y no el alias) tenemos que local_4h es <strong>EBP-0x4</strong> mientras que local_4h_2 es <strong>ESP+0x4</strong>, esto quiere decir que las primeras dos instrucciones:</p>

<pre><code>0x08048418      lea  eax, [local_4h]
0x0804841b      mov  dword [local_4h_2], eax
</code></pre>

<p>Primero guarde la dirección de EBP-0x4 en EAX y después escribí dicha dirección sobre ESP+0x4, para que acabando el primer argumento (ESP), pueda tomar el segundo del stack.</p>

<p>Renombremos las variables como numero (local_4h) y *numero (local_4h_2), ubicándonos en el nombre y dando click derecho seleccionaremos &ldquo;rename &hellip; (used here)&rdquo;:</p>

<blockquote>
<p>Hotkey: shift + n</p>
</blockquote>

<p><img src="/img/cutter03/rename-numero.png" alt="2do parámetro de scanf" /></p>

<p>Agreguemos también una etiqueta sobre el valor del primer parámetro, nos ubicamos sobre la ubicación del &ldquo;%d&rdquo; y ejecutamos renombrar:</p>

<p><img src="/img/cutter03/label.png" alt="Etiqueta de decimal" /></p>

<p>Ahora que hemos realizado lo mismo del ejercicio anterior, donde determinamos el tipo de variable que estaremos usando, continuemos con el siguiente bloque de instrucciones:</p>

<pre><code>0x0804842b      mov  dword [local_8h], 0x5a ; 'Z' ; 90
0x08048432      mov  dword [local_ch], 0x1ec ; 492
0x08048439      mov  edx, dword [local_ch]
0x0804843c      lea  eax, [local_8h]
0x0804843f      add  dword [eax], edx
0x08048441      mov  eax, dword [local_8h]
0x08048444      imul eax, dword [local_8h]
0x08048448      mov  dword [local_ch], eax
0x0804844b      mov  eax, dword [local_4h]
</code></pre>

<p>En las primeras dos instrucciones, asignamos valor a las variables local_8h y local_ch, con 90 y 492 respectivamente. Renombremos estas variables a i y j.</p>

<p><img src="/img/cutter03/i-j.png" alt="int i y j" /></p>

<pre><code>i = 90
j = 492
</code></pre>

<p>Después salvamos el valor 492 en EDX, y guardamos la ubicación de memoria de &ldquo;i&rdquo; (ebp-0x8) en EAX.</p>

<p>Continuamos por sumar 0x1ec (492) a EAX (i=90)y guardarlo en EAX. EAX ahora vale 0x246.</p>

<pre><code>i += j
</code></pre>

<p>La siguiente parte se encarga de asignar 582 a EAX. Después multiplicamos 582 * 582, osea, 582^2, dándonos 0x52b24 o 338724. Este resultado se guarda en &ldquo;i&rdquo;</p>

<pre><code>i *= i
</code></pre>

<p>Guardamos &ldquo;i&rdquo; en &ldquo;j&rdquo;:</p>

<pre><code>j = i
</code></pre>

<p>Finalmente cargamos numero en &ldquo;i&rdquo;</p>

<pre><code>i = numero
</code></pre>

<p>Continuemos con el siguiente bloque:</p>

<pre><code>0x0804844e      cmp  eax, dword [local_ch]
0x08048451      jne  0x8048461
0x08048453      mov  dword [esp], str.Password_OK_: ; [0x804856f:4]=0x73736150 ; &quot;Password OK :)\n&quot; ; const char *format
0x0804845a      call sym.imp.printf ; int printf(const char *format)
0x0804845f      jmp  0x804846d
0x08048461      mov  dword [esp], str.Invalid_Password ; [0x804857f:4]=0x61766e49 ; &quot;Invalid Password!\n&quot; ; const char *format
0x08048468      call sym.imp.printf ; int printf(const char *format)
0x0804846d      mov  eax, 0
0x08048472      leave
0x08048473      ret
</code></pre>

<p>Iniciamos por comparar i==j, si es verdadero tenemos un printf(&ldquo;Password OK :)\n&rdquo;), si es falso llamaremos a printf(&ldquo;Invalid Password!\n&rdquo;)</p>

<pre><code>    if (i==j):
      printf(&quot;Password OK :)\n&quot;)
    else:
      printf(&quot;Invalid Password!\n&quot;)
</code></pre>

<p>Finalmente tenemos EAX=0 y el leave (ESP=EBP, pop EBP) de la función main.</p>

<p>Creo que hasta este punto el análisis estático ha bastado para poder identificar la contraseña de este crackme.</p>

<h2 id="grafico">Grafico</h2>

<p>No puede faltar el grafo de esta función, en donde veamos a nuestro único if haciendo una pirueta:</p>

<p><img src="/img/cutter03/graph.png" alt="Graph" /></p>

<h2 id="validación">Validación</h2>

<p>Hemos llegado a la parte final, donde validamos la conclusión a la que hemos realizado después del análisis estático, en la cual la contraseña que debemos ingresar en el crackme es <strong>338724</strong>.</p>

<p>Validemos:</p>

<p><img src="/img/cutter03/validacion.png" alt="Validación" /></p>

<p>Excelente! Hemos resuelto el tercer crackme de IOLI.</p>

<hr />

<p>Bueno eso ha sido todo de momento, espero que les haya gustado.
Saludos,</p>

    </div>

    
    

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/crackme/">crackme</a>
          
          <a href="/tags/ioli/">ioli</a>
          
          <a href="/tags/cutter/">cutter</a>
          
          <a href="/tags/radare/">radare</a>
          
          <a href="/tags/reversing/">reversing</a>
          
        </div>

      
      <nav class="post-nav">
        
        
          <a class="next" href="/post/flareon2014_-_challenge04/">
            <span class="next-text nav-default">Flare-on 2014 - Challenge 04: Sploitastic</span>
            <span class="next-text nav-mobile"></span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'xbytemx';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://twitter.com/xbytemx" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/xbytemx" class="iconfont icon-github" title="github"></a>
  <a href="https://xbytemx.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    %!(EXTRA string=<a class="hexo-link" href="https://gohugo.io">Hugo</a>)
  </span>
  <span class="division">|</span>
  <span class="theme-info">
     - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Tony Palma</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>


<script type="text/javascript" src="/dist/even.min.js?v=3.2.0"></script>








</body>
</html>
