<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Reversing de IOLI Crackmes con Cutter - Crackme0x05 - xbytemx blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Tony Palma" />
  <meta name="description" content="Continuamos con el siguiente crackme, el cual presenta una variación del reto anterior que resolvimos, en el cual se realizaban varias comparativas diferentes, así como cast entre tipos de datos.
" />







<meta name="generator" content="Hugo 0.54.0" />


<link rel="canonical" href="https://xbytemx.github.io/post/ioli-crackmes-cutter_-_crackme0x05/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">







<link href="/dist/even.min.css?v=3.2.0" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="Reversing de IOLI Crackmes con Cutter - Crackme0x05" />
<meta property="og:description" content="Continuamos con el siguiente crackme, el cual presenta una variación del reto anterior que resolvimos, en el cual se realizaban varias comparativas diferentes, así como cast entre tipos de datos." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xbytemx.github.io/post/ioli-crackmes-cutter_-_crackme0x05/" />
<meta property="article:published_time" content="2019-02-09T22:02:44-06:00"/>
<meta property="article:modified_time" content="2019-02-09T22:02:44-06:00"/><meta property="og:site_name" content="xbytemx blog" />

<meta itemprop="name" content="Reversing de IOLI Crackmes con Cutter - Crackme0x05">
<meta itemprop="description" content="Continuamos con el siguiente crackme, el cual presenta una variación del reto anterior que resolvimos, en el cual se realizaban varias comparativas diferentes, así como cast entre tipos de datos.">


<meta itemprop="datePublished" content="2019-02-09T22:02:44-06:00" />
<meta itemprop="dateModified" content="2019-02-09T22:02:44-06:00" />
<meta itemprop="wordCount" content="1562">



<meta itemprop="keywords" content="crackme,ioli,cutter,radare,reversing," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Reversing de IOLI Crackmes con Cutter - Crackme0x05"/>
<meta name="twitter:description" content="Continuamos con el siguiente crackme, el cual presenta una variación del reto anterior que resolvimos, en el cual se realizaban varias comparativas diferentes, así como cast entre tipos de datos."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">xbytemx blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">xbytemx blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Reversing de IOLI Crackmes con Cutter - Crackme0x05</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-02-09 </span>
        <div class="post-category">
            
              <a href="/categories/reversing/"> reversing </a>
            
              <a href="/categories/elf32/"> ELF32 </a>
            
          </div>
        <span class="more-meta"> 1562 palabras </span>
        <span class="more-meta"> 8 mins lectura </span>
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contenidos</h2>
  
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#footprint">Footprint</a></li>
<li><a href="#entrypoints">Entrypoints</a></li>
<li><a href="#strings">Strings</a></li>
<li><a href="#imports">Imports</a></li>
<li><a href="#functions">Functions</a></li>
<li><a href="#disassembly">Disassembly</a>
<ul>
<li><a href="#función-main">Función main</a></li>
<li><a href="#función-check">Función check</a></li>
<li><a href="#función-parell">Función parell</a></li>
</ul></li>
<li><a href="#gráfico">Gráfico</a>
<ul>
<li><a href="#función-main-1">Función main</a></li>
<li><a href="#función-check-1">Función check</a></li>
<li><a href="#función-parell-1">Función parell</a></li>
</ul></li>
<li><a href="#validación">Validación</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    

    
    <div class="post-content">
      <p>Continuamos con el siguiente crackme, el cual presenta una variación del reto anterior que resolvimos, en el cual se realizaban varias comparativas diferentes, así como cast entre tipos de datos.</p>

<h2 id="footprint">Footprint</h2>

<p>Comenzamos como hemos resuelto otros crackmes, por realizar un file, un ldd y un readelf:</p>

<p><img src="/img/cutter06/file.png" alt="Initial info about crackme0x05" /></p>

<p>Podemos observar que la mayoría de la información que se ha presentado en otros crackmes se mantiene, así que por este momento el preCutter se detiene aquí.</p>

<p>Cargamos el binario en Cuttter:</p>

<p><img src="/img/cutter06/load.png" alt="Load on Cutter" /></p>

<p>Y como en otros ejercicios, veamos si el dashboard nos ayuda con alguna otra información adicional:</p>

<p><img src="/img/cutter06/dashboard.png" alt="Dashboard" /></p>

<p>Como podemos observar y si recordamos otros ejercicios, parece que has sido construido de la misma manera que los demás crackmes, así que hasta aquí llegamos en esta sección.</p>

<h2 id="entrypoints">Entrypoints</h2>

<p>Ahora toca el turno de analizar el entry point que vimos con readelf, el cual era 0x080483d0, veamos que dice Cutter al respecto:</p>

<p><img src="/img/cutter06/entrypoints.png" alt="Entry Points" /></p>

<p>La información coincide y es mas, podemos ver también la llamada de entry0 que tenemos para este entry point dentro de las funciones.</p>

<h2 id="strings">Strings</h2>

<p>Veamos si en los strings podemos encontrar algún indicio diferente o la variación entre este crackme y los anteriores:</p>

<p><img src="/img/cutter06/strings.png" alt="Strings" /></p>

<p>Con esta captura, concluimos que los strings no son de mucha ayuda en este crackme.</p>

<h2 id="imports">Imports</h2>

<p>Pasemos ahora a las funciones que se importan de este crackme:</p>

<p><img src="/img/cutter06/imports.png" alt="Imports" /></p>

<h2 id="functions">Functions</h2>

<p>En la sección de funciones encontraremos las que ya analizamos están importadas via libc, y adicionalmente observaremos que aparte de main, tenemos una función llamada check.</p>

<p><img src="/img/cutter06/functions.png" alt="Functions" /></p>

<p>Continuemos con el disassembly de este binario:</p>

<h2 id="disassembly">Disassembly</h2>

<h3 id="función-main">Función main</h3>

<p>Al ser el main el glue de todo el programa, iniciamos por esta función, la cual tiene el siguiente código:</p>

<p><img src="/img/cutter06/main.png" alt="pdf Main" /></p>

<p>Siguiendo la misma mecánica que con los crackme anteriores, vamos parte por parte destripando el programa.</p>

<p><img src="/img/cutter06/main1.png" alt="Main - 1" /></p>

<p><em>0x08048540 &hellip; 0x08048549</em></p>

<p>Tenemos el inicio del prologo de la función, donde se comienza a definir el stack frame para la función.</p>

<p><em>0x0804854c &hellip; 0x08048554</em></p>

<p>EAX es igual a 0, luego le sumamos 15, y luego le volvemos a sumar 15. EAX=30</p>

<p><em>0x08048557 &hellip; 0x0804855d</em></p>

<p>EAX / 2^4 y después EAX * 2^4. Resultado: EAX =16. Restamos 16 al ESP</p>

<p><img src="/img/cutter06/main2.png" alt="Main - 2" /></p>

<p><em>0x0804855f &hellip; 0x08048572</em></p>

<p>Subimos la ubicación del string de LVL al ESP, y llamamos a la función printf. Este proceso se repite otra vez con el string de &ldquo;Password: &ldquo;.</p>

<p><img src="/img/cutter06/main3.png" alt="Main - 3" /></p>

<p><em>0x08048577</em> Subimos la dirección de local_78h a EAX</p>

<p><em>0x0804857a</em> Movemos esa dirección almacenada en EAX a local_4h (ESP+4h)</p>

<p><em>0x0804857e</em> Movemos la ubicación del string &lsquo;%s&rsquo;, la cual es 0x080486b2, a ESP</p>

<p><em>0x08048585</em> Llamamos a scanf, pero ojo, recibe el argumento1 via ESP y el argumento2 via ESP+4h como en los ejercicios anteriores.</p>

<p><img src="/img/cutter06/main4.png" alt="Main - 4" /></p>

<p><em>0x0804858a</em> Bueno, parece que ahora esa dirección ya tiene un valor via scanf, ahora volvemos a llevar la dirección a EAX
<em>0x0804858d</em> Cargamos EAX en el ESP
<em>0x08048590</em> Y llamamos a otra función pasándole como parámetro la dirección del valor que tomamos de scanf.</p>

<p><img src="/img/cutter06/main5.png" alt="Main - 5" /></p>

<p>Cuando ya retornemos de la función check, únicamente retornamos 0 vía EAX y acaba la función con leave+ret.</p>

<h3 id="función-check">Función check</h3>

<p>Ahora si, la función buena a resolver:</p>

<p><img src="/img/cutter06/check.png" alt="pdf Check" /></p>

<p>No se ve tan monstruosa como la anterior, pero tiene su truco.</p>

<p><img src="/img/cutter06/check1.png" alt="Check - 1" /></p>

<p>La primera parte es equivalente al prologo de la función, donde se define un stack de 40 bytes para la función.</p>

<p><img src="/img/cutter06/check2.png" alt="Check - 2" /></p>

<p>Inicializamos local_8h y local_ch a 0. Si vemos la descripción que nos entrega cutter, veremos que estas son variables locales.</p>

<p><img src="/img/cutter06/check3.png" alt="Check - 3" /></p>

<p><em>0x080484dc</em> Asignamos el valor de s a EAX, ¿y quien es s? Pues no es mas que el parámetro que la pasamos a la función, la dirección donde se encuentra el valor que ingresamos via scanf</p>

<p><em>0x080484df</em> Ahora subimos esa dirección a ESP (whoot)</p>

<p><em>0x0804842e</em> Llamamos a strlen (que recibe la dirección del string). strlen básicamente toma un string y ejecuta un loop while incrementando un contador buscando la primera incidencia de un carácter null \x00. Al encontrarlo devuelve el valor del contador o por cuantos caracteres tuvo que evaluar para encontrar el carácter null, es decir, la longitud del string. El valor devuelto es un numero natural n&gt;0 que se almacena en EAX.</p>

<p><em>0x080484e7</em> Tomamos el valor de EAX y lo comparamos con el valor de local_ch (la variable que habíamos inicializado a 0), el resultado levanta las flags de ZF y CF según corresponda. En la primera ejecución local_ch es menor que EAX, por lo que la flag de CF se levanta.</p>

<p><em>0x080484ea</em> Tenemos un salto condicional, si el flag de CF no se levanto, entonces ejecuta el jump. Hasta que local_ch no sea igual o mayor a la longitud del string ingresado, no se ejecutara el jump.</p>

<p><img src="/img/cutter06/check4.png" alt="Check - 4" /></p>

<p>Si el jump no se ejecuta;</p>

<p><em>0x080484ec</em> Movemos el valor del contador a EAX</p>

<p><em>0x080484ef</em> Sumamos el counter y la dirección de s (el valor ingresado via scanf)</p>

<p><em>0x080484f2</em> Movemos el byte de AL a EAX (ojo, movimos el valor) y dejamos EAX lleno de ceros a la izq.</p>

<p><em>0x080484f5</em> Subimos ese valor (el byte) en local_dh.</p>

<p>Ahora local_dh vale el valor de la letra en curso según el ciclo for.</p>

<p><img src="/img/cutter06/check5.png" alt="Check - 5" /></p>

<p><em>0x080484f8</em> Subimos la dirección de local_4h a EAX</p>

<p><em>0x080484fb</em> Cargamos EAX en local_8h_2 (el que esta mas cerca del ESP)</p>

<p><em>0x080484ff</em> Movemos el valor que esta en 0x08048668 (%d)</p>

<p><em>0x08048507</em> Cargamos en EAX la dirección de local_dh (la letra en curso del texto ingresado)</p>

<p><em>0x0804850a</em> Subimos esta letra a ESP desde EAX</p>

<p><em>0x0804850d</em> Llamamos a la función sscanf, que recibe como parámetros el char *s[i], el string &lsquo;%d&rsquo;, y el entero local_4h</p>

<p>La función sscanf() se encarga de procesar un string que recibe de parámetro inicial y al igual que su pariente, scanf, recibe también el formato y opcionalmente donde almacenar el resultado. Esto nos da una clara idea de que lo que ingresemos de input, sera convertido a int y almacenado en local_4h.</p>

<p><img src="/img/cutter06/check6.png" alt="Check - 6" /></p>

<p><em>0x08048512</em> Movemos el valor de local_4h a EDX</p>

<p><em>0x08048515</em> Subimos la dirección de local_8h a EAX</p>

<p><em>0x08048518</em> Sumamos el valor de EDX (el entero de la letra en curso) y EAX (que era 0 al inicio del for, fue la primera en inicializarse), y lo guardamos en EAX</p>

<p><em>0x0804851a</em> Comparamos el valor de EAX contra 0x10 (16 en decimal)</p>

<p>Esto básicamente quiere decir que hasta este punto, local_8h es una variable fuera del ciclo donde se va sumando los valores individuales de cada carácter ingresado en el primer scanf. También significa que debemos ingresar números, puesto que la comparación se realizo contra 16, cantidad que ninguna letra puede hacer frente.</p>

<p><img src="/img/cutter06/check7.png" alt="Check - 7" /></p>

<p>Entramos en un if, que dice así;</p>

<p>Si el resultado de la comparación fue falso (no iguales), entonces brinca a 0x0804852b.</p>

<p><em>0x0804852b</em> Cargamos la dirección de contador en EAX</p>

<p><em>0x0804852e</em> Incrementamos el valor de EAX</p>

<p><em>0x08048530</em> Brincamos hacia arriba hasta 0x080484dc, donde el loop comenzó</p>

<p>Si el resultado de la comparación fue verdadero (iguales), entonces continua.</p>

<p><em>0x0804852b</em> Movemos la dirección de s a EAX</p>

<p><em>0x0804852b</em> Cargamos esa dirección en ESP</p>

<p><em>0x0804852b</em> Llamamos a la función parell que recibe de parámetro s.</p>

<p>Las ultimas tres instrucciones son básicamente cuando el loop finalizo, en donde se carga el mensaje de &ldquo;Password Incorrect&rdquo; para posteriormente imprimirlo en pantalla via printf. Tenemos un leave/ret que finaliza la función y nos regresa a main.</p>

<h3 id="función-parell">Función parell</h3>

<p>Hemos llegado hasta esta función después de recibir en main un string, enviarlo de parámetro a check, en donde fue validado  caracter por caracter, tras una conversón a entero, que la sumatoria total de todos los valores es de 16, por lo que check llama a parell enviando el string que recibió de main.</p>

<p><img src="/img/cutter06/parell.png" alt="Parell" /></p>

<p>Como podemos ver, esta función es mas pequeña que check y main, pero veremos que secretos nos aguarda.</p>

<p><img src="/img/cutter06/parell1.png" alt="Parell - 1" /></p>

<p>Esta primera parte del prologo de la función define un stack frame de 0x18 para la función.</p>

<p><img src="/img/cutter06/parell2.png" alt="Parell - 2" /></p>

<p><em>0x0804848a</em> Cargamos la dirección de local_4h en EAX</p>

<p><em>0x0804848d</em> Cargamos el valor de EAX en local_8h (Cerca de ESP)</p>

<p><em>0x08048491</em> Continuamos subiendo el valor &lsquo;%d&rsquo; a format aka ESP+0x4</p>

<p><em>0x08048499</em> Movemos la dirección del string s hacia EAX</p>

<p><em>0x0804849c</em> Cargamos la dirección del string s en ESP</p>

<p><em>0x0804849f</em> Llamamos a sscanf.</p>

<p>Ok, sscanf (*s, &lsquo;%d&rsquo;, local_4h), como en la función anterior.</p>

<p><img src="/img/cutter06/parell3.png" alt="Parell - 3" /></p>

<p><em>0x0804849f</em> Movemos el valor de local_4h a EAX (osea el numero ingresado)</p>

<p><em>0x0804849f</em> Realizamos un and entre el numero y 1. Esto quiere decir que básicamente evalúa que la salida sea o no par, aplicando una operación el bit menos significativo.</p>

<p><em>0x0804849f</em> Se realiza un test entre EAX y EAX para validar que el <strong>and</strong> haya resultado verdadero</p>

<p><img src="/img/cutter06/parell4.png" alt="Parell - 4" /></p>

<p>En caso de que el numero sea par, se imprime el mensaje &ldquo;Pasword OK!&rdquo; y se finaliza el programa con estatus 0.</p>

<p>En caso de que el numero no sea par, parell retorna a check y check a su vez finalizar el for, concluyendo con el mensaje de &ldquo;Password Incorrect.&rdquo;</p>

<h2 id="gráfico">Gráfico</h2>

<p>Los grafos de las tres funciones principales son:</p>

<h3 id="función-main-1">Función main</h3>

<p><img src="/img/cutter06/graph_main.png" alt="graph main" /></p>

<h3 id="función-check-1">Función check</h3>

<p><img src="/img/cutter06/graph_check.png" alt="graph check" /></p>

<h3 id="función-parell-1">Función parell</h3>

<p><img src="/img/cutter06/graph_parell.png" alt="graph parell" /></p>

<h2 id="validación">Validación</h2>

<p>Como la información que analizamos de este binario, concluimos que no hay una única respuesta, sino varias. La condición es que los números en serie que ingresemos puedan sumar 16 exacto y que el numero sea par, es decir, números como 04444 y 22222222 son validos. Números como 55421 no porque a pesar de que sus primeros números en serie suman 16, el numero es impar, mientras que números como 5560 o 1234512 si porque los primeros números suman 16 y son números pares.</p>

<p>Validemos:</p>

<p><img src="/img/cutter06/validacion.png" alt="Validación" /></p>

<p>Excelente! Hemos resuelto el sexto crackme de IOLI.</p>

<hr />

<p>Bueno eso ha sido todo de momento, espero que les haya gustado.
Saludos,</p>
    </div>

    
    

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/crackme/">crackme</a>
          
          <a href="/tags/ioli/">ioli</a>
          
          <a href="/tags/cutter/">cutter</a>
          
          <a href="/tags/radare/">radare</a>
          
          <a href="/tags/reversing/">reversing</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/htb_writeup_-_giddy/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">HTB write-up: Giddy</span>
            <span class="prev-text nav-mobile">Previo</span>
          </a>
        
          <a class="next" href="/post/htb_writeup_-_ypuffy/">
            <span class="next-text nav-default">HTB write-up: Ypuffy</span>
            <span class="next-text nav-mobile">Siguiente</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'xbytemx';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://twitter.com/xbytemx" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/xbytemx" class="iconfont icon-github" title="github"></a>
  <a href="https://xbytemx.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Creado con <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Tema - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    
      2018 - 
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Tony Palma</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>


<script type="text/javascript" src="/dist/even.min.js?v=3.2.0"></script>








</body>
</html>
